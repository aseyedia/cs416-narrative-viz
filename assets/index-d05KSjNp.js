(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))b(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&b(n)}).observe(document,{childList:!0,subtree:!0});function C(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function b(o){if(o.ep)return;o.ep=!0;const l=C(o);fetch(o.href,l)}})();const D=1920,N=1200;let Y=d3.json("public/assets/phillyRoads.json"),I=d3.csv("public/assets/philly_crashes.csv");Promise.all([Y,I]).then(([v,y])=>{const C=[-75.1652,39.9526],o=d3.geoMercator().center(C).scale(2e5).translate([D/2,N/2]),l=d3.geoPath().projection(o),n=d3.select("#visualization").append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${D} ${N}`).call(d3.zoom().on("zoom",function(t){n.attr("transform",t.transform)})).append("g"),T=d3.select("body").append("div").attr("class","tooltip").style("opacity",0).style("position","absolute").style("background-color","white").style("border","1px solid black").style("border-radius","5px").style("padding","10px").style("pointer-events","none"),d=d3.select("#visualization").append("div").attr("class","text-overlay").style("position","absolute").style("top","20px").style("left","20px").style("background-color","rgba(255, 255, 255, 0.7)").style("padding","10px").style("border-radius","5px").style("opacity",0),m=d3.select("#visualization").append("div").attr("class","slider-container").style("position","absolute").style("bottom","20px").style("left","20px").style("width","300px").style("display","none");m.append("input").attr("type","range").attr("min",0).attr("max",23).attr("value",0).attr("id","hourSlider"),m.append("span").attr("id","hourDisplay").text("Hour: 0");const E=d3.select("#visualization").append("select").attr("id","collisionTypeFilter").style("position","absolute").style("bottom","20px").style("right","20px").style("display","none");E.selectAll("option").data(["All Collisions","Fatalities","Bicycle Fatalities","Pedestrian Fatalities"]).enter().append("option").text(t=>t).attr("value",t=>t),n.selectAll("path.road").data(v.features.filter(t=>t.properties.highway)).enter().append("path").attr("class","road").attr("d",l).attr("fill","none").attr("stroke",t=>t.properties.highway==="residential"?"grey":"black").attr("stroke-width",t=>t.properties.highway==="residential"?.5:2).style("opacity",0).transition().duration(2e3).style("opacity",1);let f=0,s;function F(t){return y.filter(e=>e.CRASH_YEAR===t)}function A(t){switch(f=t,n.selectAll(".crash-point").remove(),T.style("opacity",0),d.html(""),m.style("display",t===5?"block":"none"),E.style("display",t===5?"block":"none"),t){case 0:P();break;case 1:x();break;case 2:$();break;case 3:U();break;case 4:L();break;case 5:H();break}}function P(){const t=c.property("value"),e=s.reduce((r,u)=>r+ +u.FATAL_COUNT,0),a=s.reduce((r,u)=>r+ +u.PED_DEATH_COUNT,0),i=s.reduce((r,u)=>r+ +u.BICYCLE_DEATH_COUNT,0),p=e-a-i;let h=`
            <h2>Philadelphia's Traffic Safety Crisis in ${t}</h2>
            <p>Philadelphia has one of the highest traffic death rates in the country, surpassing New York and Boston, and comparable to Los Angeles.</p>
            <p>In ${t}, Philadelphia saw ${e} traffic fatalities:</p>
            <ul>
                <li>${a} were pedestrians</li>
                <li>${i} were bicyclists</li>
                <li>${p} were other traffic fatalities</li>
            </ul>
        `;t==="2023"&&(h+='<p>Source: <a href="https://www.phillyvoice.com/philly-vision-zero-2023-report-traffic-deaths-vehicle-crashes-pedestrians/" target="_blank">PhillyVoice</a></p>'),h+=`
            <br>
            <p>Click through the following scenes to explore Philadelphia's traffic collision data.</p>
            <p>Use the year dropdown at the top right to change the dataset.</p>
            <p><strong>Click anywhere to begin your exploration.</strong></p>
        `,h+='<p>Source: <a href="https://crashinfo.penndot.pa.gov/PCIT/welcome.html" target="_blank">PennDOT Public Crash Database</a></p>',h+='<p><a href="https://www.flaticon.com/free-icons/philadelphia" title="philadelphia icons">Philadelphia icons created by Three musketeers - Flaticon</a></p>',d.html(h).transition().duration(1e3).style("opacity",1)}function x(){const t=c.property("value"),e=s.length;d.html(`<h2>In ${t}, there were ${e} traffic collisions in Philadelphia</h2>`).transition().duration(1e3).style("opacity",1),g(s,"blue",2,.3)}function $(){const t=c.property("value"),e=s.filter(i=>+i.FATAL_COUNT>0),a=e.reduce((i,p)=>i+ +p.FATAL_COUNT,0);d.html(`<h2>In ${t}, ${a} people lost their lives in ${e.length} fatal collisions</h2>`).transition().duration(1e3).style("opacity",1),g(e,"red",4,.6)}function U(){const t=c.property("value"),e=s.filter(i=>+i.BICYCLE_DEATH_COUNT>0),a=e.reduce((i,p)=>i+ +p.BICYCLE_DEATH_COUNT,0);d.html(`<h2>In ${t}, ${a} bicycle fatalities occurred in Philadelphia</h2>`).transition().duration(1e3).style("opacity",1),g(e,"orange",5,.8)}function L(){const t=c.property("value"),e=s.filter(i=>+i.PED_DEATH_COUNT>0),a=e.reduce((i,p)=>i+ +p.PED_DEATH_COUNT,0);d.html(`<h2>In ${t}, ${a} pedestrian fatalities occurred in Philadelphia</h2>`).transition().duration(1e3).style("opacity",1),g(e,"purple",5,.8)}function H(){const t=c.property("value");d.html(`
            <h2>Analyze ${t} Crashes by Time of Day</h2>
            <p>Use the slider below to explore how crashes occur throughout the day.</p>
            <p>Change the collision type using the dropdown menu.</p>
        `).transition().duration(1e3).style("opacity",1),_()}function g(t,e,a,i,p=!1){let h=n.selectAll(".crash-point").data(t).enter().append("circle").attr("class","crash-point").attr("cx",r=>o([+r.DEC_LONG,+r.DEC_LAT])[0]).attr("cy",r=>o([+r.DEC_LONG,+r.DEC_LAT])[1]).attr("r",a).attr("fill",e).attr("data-original-radius",a).on("mouseover",function(r,u){d3.select(this).transition().duration(100).attr("r",a*1.5),S(r,u)}).on("mouseout",function(){d3.select(this).transition().duration(100).attr("r",d3.select(this).attr("data-original-radius")),k()});p?h.attr("opacity",i):h.attr("opacity",0).transition().duration(1e3).attr("opacity",i)}function S(t,e){T.transition().duration(200).style("opacity",.9),T.html(`Date: ${e.CRASH_MONTH}/${e.CRASH_YEAR}<br>
            Time: ${e.HOUR_OF_DAY}:00<br>
            Fatalities: ${e.FATAL_COUNT}<br>
            Bicycle Fatalities: ${e.BICYCLE_DEATH_COUNT}<br>
            Pedestrian Fatalities: ${e.PED_DEATH_COUNT}<br>
            Injuries: ${e.INJURY_COUNT}`).style("left",t.pageX+5+"px").style("top",t.pageY-28+"px")}function k(){T.transition().duration(500).style("opacity",0)}function _(){const t=+d3.select("#hourSlider").property("value"),e=d3.select("#collisionTypeFilter").property("value");let a=s.filter(i=>+i.HOUR_OF_DAY===t);e==="Fatalities"?a=a.filter(i=>+i.FATAL_COUNT>0):e==="Bicycle Fatalities"?a=a.filter(i=>+i.BICYCLE_DEATH_COUNT>0):e==="Pedestrian Fatalities"&&(a=a.filter(i=>+i.PED_DEATH_COUNT>0)),n.selectAll(".crash-point").remove(),g(a,i=>+i.BICYCLE_DEATH_COUNT>0?"orange":+i.PED_DEATH_COUNT>0?"purple":+i.FATAL_COUNT>0?"red":"blue",4,.6,!0),d3.select("#hourDisplay").text(`Hour: ${t}`)}d3.select("#visualization").on("click",t=>{t.target.tagName!=="SELECT"&&t.target.tagName!=="INPUT"&&(f=(f+1)%6,A(f))}),d3.select("#hourSlider").on("input",_),d3.select("#collisionTypeFilter").on("change",_);const w=[...new Set(y.map(t=>t.CRASH_YEAR))].sort(),c=d3.select("#visualization").append("select").attr("id","yearSelect").style("position","absolute").style("top","10px").style("right","10px");c.selectAll("option").data(w).enter().append("option").text(t=>t).attr("value",t=>t),c.on("change",function(){s=F(this.value),A(f)});const O=w[w.length-1];c.property("value",O),s=F(O),A(0)});
//# sourceMappingURL=index-d05KSjNp.js.map
