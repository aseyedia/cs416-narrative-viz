(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))b(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const n of l.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&b(n)}).observe(document,{childList:!0,subtree:!0});function C(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function b(a){if(a.ep)return;a.ep=!0;const l=C(a);fetch(a.href,l)}})();const D=1920,N=1200;let Y=d3.json("public/assets/phillyRoads.json"),I=d3.csv("public/assets/philly_crashes.csv");Promise.all([Y,I]).then(([v,y])=>{const C=[-75.1652,39.9526],a=d3.geoMercator().center(C).scale(2e5).translate([D/2,N/2]),l=d3.geoPath().projection(a),n=d3.select("#visualization").append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${D} ${N}`).call(d3.zoom().on("zoom",function(t){n.attr("transform",t.transform)})).append("g"),T=d3.select("body").append("div").attr("class","tooltip").style("opacity",0).style("position","absolute").style("background-color","white").style("border","1px solid black").style("border-radius","5px").style("padding","10px").style("pointer-events","none"),d=d3.select("#visualization").append("div").attr("class","text-overlay").style("position","absolute").style("top","20px").style("left","20px").style("background-color","rgba(255, 255, 255, 0.7)").style("padding","10px").style("border-radius","5px").style("opacity",0),A=d3.select("#visualization").append("div").attr("class","slider-container").style("position","absolute").style("bottom","20px").style("left","20px").style("width","300px").style("display","none");A.append("input").attr("type","range").attr("min",0).attr("max",23).attr("value",0).attr("id","hourSlider"),A.append("span").attr("id","hourDisplay").text("Hour: 0");const E=d3.select("#visualization").append("select").attr("id","collisionTypeFilter").style("position","absolute").style("bottom","20px").style("right","20px").style("display","none");E.selectAll("option").data(["All Collisions","Fatalities","Bicycle Fatalities","Pedestrian Fatalities"]).enter().append("option").text(t=>t).attr("value",t=>t),n.selectAll("path.road").data(v.features.filter(t=>t.properties.highway)).enter().append("path").attr("class","road").attr("d",l).attr("fill","none").attr("stroke",t=>t.properties.highway==="residential"?"grey":"black").attr("stroke-width",t=>t.properties.highway==="residential"?.5:2).style("opacity",0).transition().duration(2e3).style("opacity",1);let u=0,r;function F(t){return y.filter(e=>e.CRASH_YEAR===t)}function m(t){switch(u=t,n.selectAll(".crash-point").remove(),T.style("opacity",0),d.html(""),A.style("display",t===5?"block":"none"),E.style("display",t===5?"block":"none"),t){case 0:P();break;case 1:x();break;case 2:$();break;case 3:U();break;case 4:L();break;case 5:H();break}}function P(){const t=c.property("value"),e=r.reduce((s,g)=>s+ +g.FATAL_COUNT,0),o=r.reduce((s,g)=>s+ +g.PED_DEATH_COUNT,0),i=r.reduce((s,g)=>s+ +g.BICYCLE_DEATH_COUNT,0),p=e-o-i;let h=`
            <h2>Philadelphia's Traffic Safety Crisis in ${t}</h2>
            <p>Philadelphia has one of the highest traffic death rates in the country, surpassing New York and Boston, and comparable to Los Angeles.</p>
            <p>In ${t}, Philadelphia saw ${e} traffic fatalities:</p>
            <ul>
                <li>${o} were pedestrians</li>
                <li>${i} were bicyclists</li>
                <li>${p} were other traffic fatalities</li>
            </ul>
        `;t==="2023"&&(h+='<p>Source: <a href="https://www.phillyvoice.com/philly-vision-zero-2023-report-traffic-deaths-vehicle-crashes-pedestrians/" target="_blank">PhillyVoice</a></p>'),h+=`
            <br>
            <p>Click through the following scenes to explore Philadelphia's traffic collision data.</p>
            <p>Use the year dropdown at the top right to change the dataset.</p>
            <p><strong>Click anywhere to begin your exploration.</strong></p>
        `,h+='<p>Source: <a href="https://crashinfo.penndot.pa.gov/PCIT/welcome.html" target="_blank">PennDOT Public Crash Database</a></p>',h+='<p><a href="https://www.flaticon.com/free-icons/philadelphia" title="philadelphia icons">Philadelphia icons created by Three musketeers - Flaticon</a></p>',d.html(h).transition().duration(1e3).style("opacity",1)}function x(){const t=c.property("value"),e=r.length;d.html(`<h2>In ${t}, there were ${e} traffic collisions in Philadelphia</h2>`).transition().duration(1e3).style("opacity",1),f(r,"blue",2,.3)}function $(){const t=c.property("value"),e=r.filter(i=>+i.FATAL_COUNT>0),o=e.reduce((i,p)=>i+ +p.FATAL_COUNT,0);d.html(`<h2>In ${t}, ${o} people lost their lives in ${e.length} fatal collisions</h2>`).transition().duration(1e3).style("opacity",1),f(e,"red",4,.6)}function U(){const t=c.property("value"),e=r.filter(i=>+i.BICYCLE_DEATH_COUNT>0),o=e.reduce((i,p)=>i+ +p.BICYCLE_DEATH_COUNT,0);d.html(`<h2>In ${t}, ${o} bicycle fatalities occurred in Philadelphia</h2>`).transition().duration(1e3).style("opacity",1),f(e,"orange",5,.8)}function L(){const t=c.property("value"),e=r.filter(i=>+i.PED_DEATH_COUNT>0),o=e.reduce((i,p)=>i+ +p.PED_DEATH_COUNT,0);d.html(`<h2>In ${t}, ${o} pedestrian fatalities occurred in Philadelphia</h2>`).transition().duration(1e3).style("opacity",1),f(e,"purple",5,.8)}function H(){const t=c.property("value");d.html(`
            <h2>Analyze ${t} Crashes by Time of Day</h2>
            <p>Use the slider below to explore how crashes occur throughout the day.</p>
            <p>Change the collision type using the dropdown menu.</p>
        `).transition().duration(1e3).style("opacity",1),_()}function f(t,e,o,i,p=!1){let h=n.selectAll(".crash-point").data(t).enter().append("circle").attr("class","crash-point").attr("cx",s=>a([+s.DEC_LONG,+s.DEC_LAT])[0]).attr("cy",s=>a([+s.DEC_LONG,+s.DEC_LAT])[1]).attr("r",o).attr("fill",e).on("mouseover",S).on("mouseout",k);p?h.attr("opacity",i):h.attr("opacity",0).transition().duration(1e3).attr("opacity",i)}function S(t,e){d3.select(this).attr("r",+this.getAttribute("r")+2),T.transition().duration(200).style("opacity",.9),T.html(`Date: ${e.CRASH_MONTH}/${e.CRASH_YEAR}<br>
            Time: ${e.HOUR_OF_DAY}:00<br>
            Fatalities: ${e.FATAL_COUNT}<br>
            Bicycle Fatalities: ${e.BICYCLE_DEATH_COUNT}<br>
            Pedestrian Fatalities: ${e.PED_DEATH_COUNT}<br>
            Injuries: ${e.INJURY_COUNT}`).style("left",t.pageX+5+"px").style("top",t.pageY-28+"px")}function k(){d3.select(this).attr("r",this.getAttribute("r")),T.transition().duration(500).style("opacity",0)}function _(){const t=+d3.select("#hourSlider").property("value"),e=d3.select("#collisionTypeFilter").property("value");let o=r.filter(i=>+i.HOUR_OF_DAY===t);e==="Fatalities"?o=o.filter(i=>+i.FATAL_COUNT>0):e==="Bicycle Fatalities"?o=o.filter(i=>+i.BICYCLE_DEATH_COUNT>0):e==="Pedestrian Fatalities"&&(o=o.filter(i=>+i.PED_DEATH_COUNT>0)),n.selectAll(".crash-point").remove(),f(o,i=>+i.BICYCLE_DEATH_COUNT>0?"orange":+i.PED_DEATH_COUNT>0?"purple":+i.FATAL_COUNT>0?"red":"blue",4,.6,!0),d3.select("#hourDisplay").text(`Hour: ${t}`)}d3.select("#visualization").on("click",t=>{t.target.tagName!=="SELECT"&&t.target.tagName!=="INPUT"&&(u=(u+1)%6,m(u))}),d3.select("#hourSlider").on("input",_),d3.select("#collisionTypeFilter").on("change",_);const w=[...new Set(y.map(t=>t.CRASH_YEAR))].sort(),c=d3.select("#visualization").append("select").attr("id","yearSelect").style("position","absolute").style("top","10px").style("right","10px");c.selectAll("option").data(w).enter().append("option").text(t=>t).attr("value",t=>t),c.on("change",function(){r=F(this.value),m(u)});const O=w[w.length-1];c.property("value",O),r=F(O),m(0)});
//# sourceMappingURL=index-DbbCWDV7.js.map
