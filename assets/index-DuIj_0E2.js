(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))A(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&A(n)}).observe(document,{childList:!0,subtree:!0});function T(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function A(a){if(a.ep)return;a.ep=!0;const r=T(a);fetch(a.href,r)}})();const D=1920,N=1200;let k=d3.json("../assets/phillyRoads.json"),B=d3.csv("../assets/philly_crashes.csv");Promise.all([k,B]).then(([w,y])=>{const T=[-75.1652,39.9526],a=d3.geoMercator().center(T).scale(2e5).translate([D/2,N/2]),r=d3.geoPath().projection(a),n=d3.select("#visualization").append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${D} ${N}`).call(d3.zoom().on("zoom",function(t){n.attr("transform",t.transform)})).append("g"),C=d3.select("body").append("div").attr("class","tooltip").style("opacity",0).style("position","absolute").style("background-color","white").style("border","1px solid black").style("border-radius","5px").style("padding","10px").style("pointer-events","none"),h=d3.select("#visualization").append("div").attr("class","text-overlay").style("position","absolute").style("top","20px").style("left","20px").style("background-color","rgba(255, 255, 255, 0.7)").style("padding","10px").style("border-radius","5px").style("opacity",0),b=d3.select("#visualization").append("div").attr("class","slider-container").style("position","absolute").style("bottom","20px").style("left","20px").style("width","300px").style("display","none");b.append("input").attr("type","range").attr("min",0).attr("max",23).attr("value",0).attr("id","hourSlider"),b.append("span").attr("id","hourDisplay").text("Hour: 0");const E=d3.select("#visualization").append("select").attr("id","collisionTypeFilter").style("position","absolute").style("bottom","20px").style("right","20px").style("display","none");E.selectAll("option").data(["All Collisions","Fatalities","Bicycle Fatalities","Pedestrian Fatalities"]).enter().append("option").text(t=>t).attr("value",t=>t),n.selectAll("path.road").data(w.features.filter(t=>t.properties.highway)).enter().append("path").attr("class","road").attr("d",r).attr("fill","none").attr("stroke",t=>t.properties.highway==="residential"?"grey":"black").attr("stroke-width",t=>t.properties.highway==="residential"?.5:2).style("opacity",0).transition().duration(2e3).style("opacity",1);let u=0,s;function F(t){return y.filter(e=>e.CRASH_YEAR===t)}function _(t){switch(u=t,n.selectAll(".crash-point").remove(),C.style("opacity",0),h.html(""),b.style("display",t===5?"block":"none"),E.style("display",t===5?"block":"none"),t){case 0:x();break;case 1:P();break;case 2:$();break;case 3:U();break;case 4:L();break;case 5:H();break}}function x(){const t=c.property("value"),e=s.reduce((l,g)=>l+ +g.FATAL_COUNT,0),o=s.reduce((l,g)=>l+ +g.PED_DEATH_COUNT,0),i=s.reduce((l,g)=>l+ +g.BICYCLE_DEATH_COUNT,0),p=e-o-i;let d=`
            <h2>Philadelphia's Traffic Safety Crisis in ${t}</h2>
            <p>Philadelphia has one of the highest traffic death rates in the country, surpassing New York and Boston, and comparable to Los Angeles.</p>
            <p>In ${t}, Philadelphia saw ${e} traffic fatalities:</p>
            <ul>
                <li>${o} were pedestrians</li>
                <li>${i} were bicyclists</li>
                <li>${p} were other traffic fatalities</li>
            </ul>
        `;t==="2023"&&(d+='<p>Source: <a href="https://www.phillyvoice.com/philly-vision-zero-2023-report-traffic-deaths-vehicle-crashes-pedestrians/" target="_blank">PhillyVoice</a></p>'),d+=`
            <br>
            <p>Click through the following scenes to explore Philadelphia's traffic collision data.</p>
            <p>Use the year dropdown at the top right to change the dataset.</p>
            <p><strong>Click anywhere to begin your exploration.</strong></p>
        `,h.html(d).transition().duration(1e3).style("opacity",1)}function P(){const t=c.property("value"),e=s.length;h.html(`<h2>In ${t}, there were ${e} traffic collisions in Philadelphia</h2>`).transition().duration(1e3).style("opacity",1),f(s,"blue",2,.3)}function $(){const t=c.property("value"),e=s.filter(i=>+i.FATAL_COUNT>0),o=e.reduce((i,p)=>i+ +p.FATAL_COUNT,0);h.html(`<h2>In ${t}, ${o} people lost their lives in ${e.length} fatal collisions</h2>`).transition().duration(1e3).style("opacity",1),f(e,"red",4,.6)}function U(){const t=c.property("value"),e=s.filter(i=>+i.BICYCLE_DEATH_COUNT>0),o=e.reduce((i,p)=>i+ +p.BICYCLE_DEATH_COUNT,0);h.html(`<h2>In ${t}, ${o} bicycle fatalities occurred in Philadelphia</h2>`).transition().duration(1e3).style("opacity",1),f(e,"orange",5,.8)}function L(){const t=c.property("value"),e=s.filter(i=>+i.PED_DEATH_COUNT>0),o=e.reduce((i,p)=>i+ +p.PED_DEATH_COUNT,0);h.html(`<h2>In ${t}, ${o} pedestrian fatalities occurred in Philadelphia</h2>`).transition().duration(1e3).style("opacity",1),f(e,"purple",5,.8)}function H(){const t=c.property("value");h.html(`
            <h2>Analyze ${t} Crashes by Time of Day</h2>
            <p>Use the slider below to explore how crashes occur throughout the day.</p>
            <p>Change the collision type using the dropdown menu.</p>
        `).transition().duration(1e3).style("opacity",1),m()}function f(t,e,o,i,p=!1){let d=n.selectAll(".crash-point").data(t).enter().append("circle").attr("class","crash-point").attr("cx",l=>a([+l.DEC_LONG,+l.DEC_LAT])[0]).attr("cy",l=>a([+l.DEC_LONG,+l.DEC_LAT])[1]).attr("r",o).attr("fill",e).on("mouseover",S).on("mouseout",Y);p?d.attr("opacity",i):d.attr("opacity",0).transition().duration(1e3).attr("opacity",i)}function S(t,e){d3.select(this).attr("r",+this.getAttribute("r")+2),C.transition().duration(200).style("opacity",.9),C.html(`Date: ${e.CRASH_MONTH}/${e.CRASH_YEAR}<br>
            Time: ${e.HOUR_OF_DAY}:00<br>
            Fatalities: ${e.FATAL_COUNT}<br>
            Bicycle Fatalities: ${e.BICYCLE_DEATH_COUNT}<br>
            Pedestrian Fatalities: ${e.PED_DEATH_COUNT}<br>
            Injuries: ${e.INJURY_COUNT}`).style("left",t.pageX+5+"px").style("top",t.pageY-28+"px")}function Y(){d3.select(this).attr("r",this.getAttribute("r")),C.transition().duration(500).style("opacity",0)}function m(){const t=+d3.select("#hourSlider").property("value"),e=d3.select("#collisionTypeFilter").property("value");let o=s.filter(i=>+i.HOUR_OF_DAY===t);e==="Fatalities"?o=o.filter(i=>+i.FATAL_COUNT>0):e==="Bicycle Fatalities"?o=o.filter(i=>+i.BICYCLE_DEATH_COUNT>0):e==="Pedestrian Fatalities"&&(o=o.filter(i=>+i.PED_DEATH_COUNT>0)),n.selectAll(".crash-point").remove(),f(o,i=>+i.BICYCLE_DEATH_COUNT>0?"orange":+i.PED_DEATH_COUNT>0?"purple":+i.FATAL_COUNT>0?"red":"blue",4,.6,!0),d3.select("#hourDisplay").text(`Hour: ${t}`)}d3.select("#visualization").on("click",t=>{t.target.tagName!=="SELECT"&&t.target.tagName!=="INPUT"&&(u=(u+1)%6,_(u))}),d3.select("#hourSlider").on("input",m),d3.select("#collisionTypeFilter").on("change",m);const v=[...new Set(y.map(t=>t.CRASH_YEAR))].sort(),c=d3.select("#visualization").append("select").attr("id","yearSelect").style("position","absolute").style("top","10px").style("right","10px");c.selectAll("option").data(v).enter().append("option").text(t=>t).attr("value",t=>t),c.on("change",function(){s=F(this.value),_(u)});const O=v[v.length-1];c.property("value",O),s=F(O),_(0)});
//# sourceMappingURL=index-DuIj_0E2.js.map
